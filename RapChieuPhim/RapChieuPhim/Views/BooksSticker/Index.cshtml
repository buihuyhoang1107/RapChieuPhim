@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@section css {
    <link href="~/css/booking.css" rel="stylesheet" />
}

<div class="main">
    @await Html.PartialAsync("../Shared/_MenuPartial.cshtml")
    <div class="contact-content container>
        @await Html.PartialAsync("../Shared/_TopHeaderPartial.cshtml")
        <div class="main-contact ">
            <div class="row">
                <h2 id="ten_phim">Chọn phim</h2>
                <select name="Phim" id="Phim_id" class="col-lg-6">
                    @if (ViewBag.ListPhim.Count == 0)
                    {
                        <option value="-1">Không có phim này</option>
                    }
                    @foreach (PhimModel phim in ViewBag.ListPhim)
                    {
                        <option value="@phim.ID">@phim.Ten_phim</option>
                    }
                </select>
            </div>
            <div class="row">
                <p class="col-lg-6 ">Chọn rạp phim</p>
                <select name="rap" id="Rap_phim_id" class="col-lg-6">
                    @if (ViewBag.RapPhim.Count == 0)
                    {
                        <option value="-1">Không có rạp chiếu phim này</option>
                    }
                    @foreach (RapPhimModel rap in ViewBag.RapPhim)
                    {
                        <option value="@rap.ID">@rap.Ten_rap</option>
                    }
                </select>
            </div>
            <div class="row">
                <p class="col-lg-6">Chọn lịch chiếu</p>
                <select name="rap" id="Lich_Chieu_id" class="col-lg-6">
                    @if (ViewBag.LichChieu.Count == 0)
                    {
                        <option value="-1">Không có lịch chiếu phim này</option>
                    }
                    @foreach (LichChieuModel lich in ViewBag.LichChieu)
                    {
                        <option value="@lich.ID">@lich.Ngay.ToShortDateString()</option>
                    }
                </select>
            </div>
            <div class="row">
                <p class="col-lg-6">Chọn xuất chiếu</p>
                <select name="rap" id="Xuat_Chieu_id" class="col-lg-6">
                    @if (ViewBag.XuatChieu.Count == 0)
                    {
                        <option value="-1">Không có xuất chiếu phim này</option>
                    }
                    @foreach (XuatChieuModel xuat in ViewBag.XuatChieu)
                    {
                        <option value="@xuat.ID">@xuat.Thoi_gian</option>
                    }
                </select>
            </div>


            <div class="clearfix"></div>
            <h3>Chọn Ghế</h3>
            <div class="row col-lg-6" id="ghe_id">
            </div>

            <div class="clearfix"></div>
        </div>
        @await Html.PartialAsync("../Shared/_FooterPartial.cshtml")
    </div>
</div>
<div class="clearfix"></div>

@section Scripts{
    <script>
        $(document).ready(function () {
            document.getElementById("Phim_id").value = @ViewBag.Phim.ID;
            console.log(@ViewBag.Phim.ID)
            var list_ghe = document.getElementById("ghe_id");
            var str = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
            //console.log(list_ghe);
            for (i = 0; i < 9; ++i) {
                for (j = 0; j < 10; ++j) {
                    var ghe = document.createElement("div");
                    ghe.className = "col-xs-1-10 btn btn-info";
                    ghe.innerText = str[i] + j;
                    list_ghe.appendChild(ghe);
                }
            }
            document.getElementById("Phim_id").onchange = function (e) {
                const id = e.target.value;
                window.location.href = `./BooksSticker?phim_id=${id}`;
            };
            document.getElementById("Rap_phim_id").onchange = function (e) {
                const rap_id = e.target.value;
                const phim_id = document.getElementById("Phim_id").value;
                var lichChieu = document.getElementById("Lich_Chieu_id");
                console.log(rap_id);
                console.log(phim_id);
                $.getJSON(`./api/LichChieu/phim/${phim_id}/rap/${rap_id}`, (data, status) => {
                    console.log(typeof (data));
                    console.log(data);
                    lichChieu.innerHTML = "";
                    if (data.length == 0) {
                        var option = document.createElement("option");
                        option.value = -1;
                        option.innerText = "Không có lịch chiếu phim này";
                        return;
                    };
                    data.forEach((item) => {
                        var option = document.createElement("option");
                        option.value = item.id;
                        var d = new Date(item.ngay);
                        var ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(d);
                        var mo = new Intl.DateTimeFormat('en', { month: '2-digit' }).format(d);
                        var da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(d);
                        option.innerText = `${da}/${mo}/${ye}`;
                        lichChieu.appendChild(option);
                    });

                    const lich_id = lichChieu.value;
                    const phim_id = document.getElementById("Phim_id").value;
                    var xuatChieu = document.getElementById("Xuat_Chieu_id");
                    console.log(lich_id);
                    console.log(phim_id);
                    $.getJSON(`./api/XuatChieu/phim/${phim_id}/lich/${lich_id}`, (data, status) => {
                        console.log(typeof (data));
                        console.log(data);
                        xuatChieu.innerHTML = "";
                        if (data.length == 0) {
                            var option = document.createElement("option");
                            option.value = -1;
                            option.innerText = "Không có xuất chiếu phim này";
                            return;
                        };
                        data.forEach((item) => {
                            var option = document.createElement("option");
                            option.value = item.id;
                            option.innerText = item.thoi_gian;
                            xuatChieu.appendChild(option);
                        });
                    });
                });
            };
            document.getElementById("Lich_Chieu_id").onchange = function (e) {
                const lich_id = e.target.value;
                const phim_id = document.getElementById("Phim_id").value;
                var xuatChieu = document.getElementById("Xuat_Chieu_id");
                console.log(lich_id);
                console.log(phim_id);
                $.getJSON(`./api/XuatChieu/phim/${phim_id}/lich/${lich_id}`, (data, status) => {
                    console.log(typeof (data));
                    console.log(data);
                    xuatChieu.innerHTML = "";
                    if (data.length == 0) {
                        var option = document.createElement("option");
                        option.value = -1;
                        option.innerText = "Không có xuất chiếu phim này";
                        return;
                    };
                    data.forEach((item) => {
                        var option = document.createElement("option");
                        option.value = item.id;
                        option.innerText = item.thoi_gian;
                        xuatChieu.appendChild(option);
                    });
                });
            };
        });
    </script>
}